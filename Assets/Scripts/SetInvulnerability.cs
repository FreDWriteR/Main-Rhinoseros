using UnityEngine;

public class SetInvulnerability : MonoBehaviour
{
    // Start is called before the first frame update
    void Start()
    {

    }

    private void OnTriggerEnter(Collider other)
    {
        if (other != null && other.name.Length > 10)
            if (other.name.Substring(0, 10) == "RHINOCEROS" && other.name != gameObject.transform.parent.name)
                if (gameObject.transform.parent.gameObject.GetComponent<RhinocerosController>().HookMagnitude <=
                    other.gameObject.GetComponent<RhinocerosController>().HookMagnitude) //Если длина пройденного пути в рывке меньше чем у противника, 
                                                                                         //значит рывок был начат позже либо не начат. Если длины игроков равны и у второго включен триггер
                                                                                         //регистрируем оба попадания и даём очко каждому
                {
                    if (gameObject.transform.parent.gameObject.GetComponent<RhinocerosController>().HookMagnitude <
                    other.gameObject.GetComponent<RhinocerosController>().HookMagnitude)
                        //Чтобы неуязвимость жертвы успевала активироваться до присвоения очка игроку, запускаем команду подсчета из команды активации неуязвимости
                        gameObject.transform.parent.gameObject.GetComponent<RhinocerosController>().CmdSetOffInvulnerability(other.gameObject.GetComponent<Mirror.NetworkIdentity>().connectionToClient.connectionId);
                    else if (other.gameObject.transform.Find("TriggerCollider").GetComponent<CapsuleCollider>().isTrigger)
                        gameObject.transform.parent.gameObject.GetComponent<RhinocerosController>().CmdSetOffInvulnerability(gameObject.transform.parent.gameObject.GetComponent<Mirror.NetworkIdentity>().connectionToClient.connectionId);
                    else
                        other.gameObject.GetComponent<RhinocerosController>().CmdSetOffInvulnerability(gameObject.transform.parent.gameObject.GetComponent<Mirror.NetworkIdentity>().connectionToClient.connectionId);
                }
                else if (!other.gameObject.transform.Find("TriggerCollider").GetComponent<CapsuleCollider>().isTrigger)
                        other.gameObject.GetComponent<RhinocerosController>().CmdSetOffInvulnerability(gameObject.transform.parent.gameObject.GetComponent<Mirror.NetworkIdentity>().connectionToClient.connectionId);         
    }


    // Update is called once per frame
    void Update()
    {
        
    }
}
